<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><meta property="twitter:card" content="summary_large_image"/><link rel="shortcut icon" type="image/png" href="data:image/png;base64,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"/><noscript></noscript><meta name="generator" content="Gatsby 2.18.10"/><link rel="sitemap" type="application/xml" href="/public-wiki/sitemap.xml"/><title data-react-helmet="true"></title><link data-react-helmet="true" rel="canonical" href="https://bodhi-root.github.io/public-wiki//public-wiki//google-cloud-platform/pubsub-streaming-to-bigquery"/><link as="script" rel="preload" href="/public-wiki/webpack-runtime-f2d0ecacffeda2b3fda9.js"/><link as="script" rel="preload" href="/public-wiki/commons-926e13980b7ff3c9526c.js"/><link as="script" rel="preload" href="/public-wiki/app-a84f0d851128ba8e273f.js"/><link as="fetch" rel="preload" href="/public-wiki/page-data/google-cloud-platform/pubsub-streaming-to-bigquery/page-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group" id="gatsby-focus-wrapper"><div><style data-emotion-css="w1h108">@import url('https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap');@import url('https://fonts.googleapis.com/css?family=Poppins:300,400,500,600&display=swap');*{margin:0;padding:0;box-sizing:border-box;font-display:swap;}::-webkit-input-placeholder{color:#c2c2c2;}:-ms-input-placeholder{color:#c2c2c2;}::-webkit-input-placeholder{color:#c2c2c2;}::-moz-placeholder{color:#c2c2c2;}:-ms-input-placeholder{color:#c2c2c2;}::placeholder{color:#c2c2c2;}html,body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Roboto Light','Oxygen','Ubuntu','Cantarell','Fira Sans','Droid Sans','Helvetica Neue',sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:16px;-webkit-scroll-behavior:smooth;-moz-scroll-behavior:smooth;-ms-scroll-behavior:smooth;scroll-behavior:smooth;}a{-webkit-transition:color 0.15s;transition:color 0.15s;}body{font-family:'Roboto';}.visibleMobile{display:none;}.visibleMobileView{display:none !important;}.video-responsive{position:relative;padding-bottom:56.2%;}a{-webkit-text-decoration:none;text-decoration:none;}a:hover{-webkit-text-decoration:none;text-decoration:none;}.displayInline{display:inline-block;}.navBarToggle{border:0px solid #fff;border-radius:4px;width:36px;height:33px;position:absolute;right:20px;padding:8px 5px;display:none;}.navBarToggle .iconBar{display:block;width:22px;height:2px;border-radius:1px;margin:0 auto;margin-top:4px;background-color:#001934;}.navBarToggle .iconBar:first-child{margin-top:0px;}.video-responsive iframe{position:absolute;width:100%;height:100%;}.diffNewLine{color:#22863a;background-color:#f0fff4;}.diffRemoveLine{color:red;background-color:#ffcccc;}.navBarParent{width:100%;float:left;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.divider{height:30px;margin:0 15px;border-right:1px solid rgba(255,255,255,0.3);}.githubIcon{width:15px;margin-right:5px;}.githubSection{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;color:#000;opacity:0.7;}.githubSection:hover{-webkit-text-decoration:none;text-decoration:none;opacity:1;}.navbar-default .navbar-toggle .icon-bar{background-color:#fff !important;}.navbar-default .navbar-toggle:focus,.navbar-default .navbar-toggle:hover{background-color:#001933;}.headerWrapper{border-bottom:1px solid rgb(212,218,223);box-shadow:rgba(116,129,141,0.1) 0px 1px 1px 0px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.formElement{background-color:transparent;padding:4px;border-radius:5px;position:relative;}.formElement:focus{outline:none;border:none;}.formElement svg path{fill:#2fd2c5;}.searchInput{width:100%;background-color:rgba(28,211,198,.12) !important;border-width:0 !important;color:#C2C2C2;padding:10px;border-radius:5px;color:#fff;opacity:.6;padding-left:38px;max-width:600px;}.searchInput:focus,.searchInput:visited,.searchInput:hover,.searchInput:focus-within{outline:none;border:0;}.searchWrapper{padding-left:0px;padding-right:20px;-webkit-flex:1;-ms-flex:1;flex:1;position:relative;}.searchWrapper a{font-weight:500;}.hitWrapper{background-color:#fff;padding:0.7em 1em 0.4em;border-radius:4px;position:absolute;width:80vw;max-width:30em;top:40px;border:1px solid #ccc;box-shadow:0 1px 4px 0 rgba(0,0,0,0.16);height:auto;max-height:80vh;overflow:scroll;left:0;}.hitWrapper ul li{margin-top:0.7em;padding-top:0.7em;border-top:1px solid;list-style-type:none;}.hitWrapper ul li:first-child{border-top:0px;margin-top:0px;color:black !important;padding:0px;}.showResults{display:block;}.hideResults{display:none;}.hitWrapper span{color:black;font-size:14px;}.headerTitle{height:auto;font-size:16px;line-height:1.5;font-weight:300;color:#fff !important;margin-top:16px;text-transform:uppercase;}.headerTitle a{color:#fff;font-size:150%;}.headerTitle a:hover{-webkit-text-decoration:none;text-decoration:none;opacity:0.8;}.logoWrapper{padding:21px 0;padding-left:20px;}.logoContent{font-family:'Roboto';margin-left:16px;font-size:28px;line-height:1.5;font-weight:500;padding-right:10px;}.removePadd{padding:0 !important;}.navBarDefault{background-color:#001934;border-radius:0;border-top:0;margin-bottom:0;border:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.4);-webkit-box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.4);-moz-box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.8);-o-box-shadow:-1px 0px 4px 1px rgba(175,158,232,0.4);z-index:1;padding:15px;position:relative;height:80px;}.navBarHeader{min-width:335px;padding-right:20px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.navBarBrand{padding:0px 0px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.navBarBrand img{width:60px;height:60px;margin-right:6px;display:inline-block;}.navBarUL li{list-style-type:none;}.navBarUL{-webkit-overflow-scrolling:touch;}.navBarUL li a{font-family:'Roboto';color:#fff !important;font-size:16px;font-weight:500;line-height:1em;opacity:1;padding:10px 15px;}.navBarNav{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.navBarUL li a img,.navBarUL li a .shareIcon{width:20px;}.navBarUL li a:hover{opacity:0.7;}pre{border:0 !important;background-color:rgb(245,247,249);}blockquote{color:rgb(116,129,141);margin:0px 0px 24px;padding:0px 0px 0px 12px;border-left:4px solid rgb(230,236,241);border-color:rgb(230,236,241);}.socialWrapper{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.socialWrapper li{display:inline-block;}.socialWrapper li a{display:contents;}.discordBtn,.twitterBtn{border-radius:4px;border:solid 1px #d1d2d3;background-color:#f1f5f8;width:20px;height:20px;padding-top:2px;margin-left:8px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;-webkit-box-pack:center;-webkit-justify-content:center;-ms-flex-pack:center;justify-content:center;opacity:.8;cursor:pointer;}.twitterBtn img{width:12px !important;}.discordBtn img{width:10px !important;}.discordBtn:hover,.twitterBtn:hover{opacity:1;}.discordBtn img{width:10px;}.sidebarTitle{background-color:#f8f8f8;padding:18px 16px;font-family:'Poppins';font-size:18px;font-weight:600;color:#001934;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.sideBarShow{display:none;}.sidebarTitle a{color:#001934;}.greenCircle{width:8px;height:8px;background-color:#1cd3c6;border-radius:50%;margin:0 12px;}.headerNav{font-family:'Roboto';padding:0px 24px;color:#001933;font-size:16px;font-weight:500;line-height:1em;}.headerNav a{color:#001933;-webkit-text-decoration:none;text-decoration:none;}.headerNav a:hover{-webkit-text-decoration:none;text-decoration:none;}.logoWrapper img{width:40px;}.sideBarUL{margin-top:32px;}.sideBarUL li{list-style-type:none;width:auto;}.sideBarUL li a{font-size:14px;font-weight:500;line-height:1.5;padding:7px 24px 7px 16px;padding-left:10px;padding-right:25px;border-style:solid none solid solid;border-width:1px 0px 1px 1px;border-color:transparent currentcolor transparent transparent;}.hideFrontLine .collapser{background:transparent;border:none;outline:none;position:absolute;right:20px;z-index:1;cursor:pointer;}.hideFrontLine .active > a{background-color:#003268;color:#fff !important;}.firstLevel ul li .collapser svg path{fill:#fff !important;}.active .collapser > svg > path{fill:#001933 !important;}.firstLevel ul .item ul .item{border-left:1px solid #e6ecf1;}.sideBarUL .item{list-style:none;padding:0;}.sideBarUL .item > a{color:#fff;-webkit-text-decoration:none;text-decoration:none;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;position:relative;width:100%;padding-right:35px;padding-left:15px;}.showFrontLine .item > a:hover{background-color:hsla(0,0%,100%,.06);}.showFrontLine .active > a{background-color:#003268;color:#fff !important;}.sideBarUL .item .item{margin-left:16px;}.firstLevel > ul > .item{margin-left:0 !important;}.showFrontLine .item .item{border-left:1px solid #e6ecf1;border-left-color:rgb(230,236,241);padding:0;width:calc(100% - 16px) !important;}.showFrontLine .item .active > a{border-color:rgb(230,236,241) !important;border-style:solid none solid solid;border-width:1px 0px 1px 1px;background-color:#003268;!important;color:#fff;}.titleWrapper{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;padding-bottom:40px;border-bottom:1px solid rgb(230,236,241);margin-bottom:32px;}.gitBtn{height:30px;min-height:30px;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.gitBtn img{width:15px;display:inline-block;margin-right:5px;}.addPaddTopBottom{padding:50px 0;}.preRightWrapper{display:block;margin:0px;-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;padding:16px;text-align:right;}.smallContent{display:block;margin:0px;padding:0px;color:#6e6e6e;}.smallContent span{font-size:12px;line-height:1.625;font-weight:400;}.nextRightWrapper{display:block;margin:0px;padding:16px;-webkit-flex:1 1 0%;-ms-flex:1 1 0%;flex:1 1 0%;}table{padding:0;border-spacing:0;border-collapse:collapse;}table tr{border-top:1px solid #cccccc;margin:0;padding:0;}table tr:nth-child(2n){background-color:#f8f8f8;}table tr th{font-weight:bold;border:1px solid #cccccc;text-align:left;margin:0;padding:6px 13px;}table tr td{border:1px solid #cccccc;text-align:left;margin:0;padding:6px 13px;}table tr th:first-child,table tr td:first-child{margin-top:0;}table tr th:last-child,table tr td:last-child{margin-bottom:0;}img{max-width:100%;}.githubBtn{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;font-size:16px;padding:10px 0px;padding-left:15px;max-height:40px;}.githubBtn span span{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.communitySection{font-size:24px;font-weight:700;}.authorSection{padding:20px 0;}.authorSection,.authorName{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.authorImg img{width:75px;height:75px;border-radius:50%;min-width:75px;max-width:75px;min-height:75px;max-height:75px;}.authorDetails{padding-left:10px;}.authorDesc{padding-top:5px;font-size:14px;}.authorName img{margin-left:10px;display:inline-block;width:20px;}.authorName img:hover{opacity:0.7;}.heading1{font-size:26px;font-weight:800;line-height:1.5;margin-bottom:16px;margin-top:32px;}.heading2{font-size:24px;font-weight:700;line-height:1.5;margin-bottom:16px;margin-top:32px;}.heading3{font-size:20px;font-weight:600;line-height:1.5;margin-bottom:16px;margin-top:32px;}.heading4{font-size:18px;font-weight:500;line-height:1.5;margin-bottom:16px;margin-top:32px;}.heading5{font-size:16px;font-weight:400;line-height:1.5;margin-bottom:16px;margin-top:32px;}.heading6{font-size:14px;font-weight:300;line-height:1.5;margin-bottom:16px;margin-top:32px;}.paragraph{margin:16px 0px 32px;line-height:1.625;}.pre{font-size:14px;margin:0px;padding:16px;overflow:auto;}.poweredBy{font-size:0.6em;text-align:end;padding:0;}.topnav{-webkit-transition:top 0.5s,bottom 0.5s;}@media (max-width:767px){.formElement svg path{fill:#001934;}.visibleMobileView{display:block !important;}.searchInput{color:#001934;}.socialWrapper{position:absolute;right:10px;top:29px;}.responsive{margin-top:15px;position:relative;padding-bottom:20px;}.headerTitle{padding-right:50px;font-size:16px;}.navBarBrand{min-height:40px;}.navBarBrand img{margin-right:8px;}.topnav.responsive .visibleMobile{display:block;}.topnav .navBarUL{display:none;}.topnav.responsive .navBarUL{display:block;text-align:left;}.hiddenMobile{display:none !important;}hr{margin-top:0;margin-bottom:0;}.navBarParent{display:block;}.separator{margin-top:20px;margin-bottom:20px;}.navBarULRight{position:static;}.navBarUL{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin:7.5px 0px;}.navBarUL li{height:37px;}.navBarUL li a{font-size:14px;padding:10px 15px;}.navBarDefault{display:block;height:auto;}.navBarToggle{margin-right:0;display:block;position:absolute;left:11px;top:15px;background:#fff;}.navBarHeader{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;min-width:auto;padding-right:0;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}.navBarBrand{font-size:20px;padding:0 0;padding-left:0;-webkit-flex:initial;-ms-flex:initial;flex:initial;padding-right:15px;}.titleWrapper{padding:0 15px;display:block;}.gitBtn{display:inline-block;}.mobileView{text-align:left !important;padding-left:0 !important;}.searchWrapper{padding:0px 0;padding-top:0px;position:absolute;bottom:0px;width:calc(100% - 70px);position:absolute;left:40px;top:8px;}.hitWrapper{width:100%;right:0;top:35px;max-height:-webkit-fit-content;max-height:-moz-fit-content;max-height:fit-content;position:static;}}@media (min-width:768px) and (max-width:991px){.navBarDefault{padding:10px;}.navBarBrand{font-size:22px;}.navBarHeader{min-width:240px;-webkit-flex:initial;-ms-flex:initial;flex:initial;}.githubBtn{padding:10px 10px;}.divider{margin:0 5px;height:20px;}.hitWrapper{max-width:500px;}.navBarUL li a{padding:10px 5px;}.searchWrapper{padding-left:0px;}}</style><div class="navBarWrapper"><nav class="navBarDefault"><div class="navBarHeader"><a class="navBarBrand" href="/public-wiki/"><img class="img-responsive displayInline" src="data:image/png;base64,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" alt="logo"/></a><div class="headerTitle displayInline"><a href="/public-wiki/">Dan's Notes</a></div></div><div id="navbar" class="topnav"><div class="visibleMobile"><style data-emotion-css="1sd11cc">.css-1sd11cc{width:100%;height:100vh;overflow:auto;position:fixed;padding-left:0px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;padding-right:0;}@media only screen and (max-width:1023px){.css-1sd11cc{width:100%;height:100vh;}}@media (min-width:767px) and (max-width:1023px){.css-1sd11cc{padding-left:0;}}@media only screen and (max-width:767px){.css-1sd11cc{padding-left:0px;height:auto;}}</style><aside class="css-1sd11cc e1sbq3r11"><ul class="sideBarUL"><li class="hideFrontLine firstLevel item "><ul><li class=" item "><a href="/public-wiki/google-cloud-platform">Google Cloud Platform<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/computer-technology">Computer Technology<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/lean-process-management">Lean Process Management<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/class-notes">Class Notes<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/personal">About Me<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li></ul></li></ul></aside></div><ul class="navBarUL navBarNav navBarULRight"><li class="divider hiddenMobile"></li></ul></div></nav><style data-emotion-css="17orq4u">.css-17orq4u{height:60px;background-color:#001932;position:relative;display:none;}@media (max-width:767px){.css-17orq4u{display:block;}}</style><div class="css-17orq4u e1217p0e0"><div class="navBarDefault removePadd"><span class="navBarToggle" role="button" tabindex="0"><span class="iconBar"></span><span class="iconBar"></span><span class="iconBar"></span></span></div></div></div><style data-emotion-css="1801c4e">.css-1801c4e{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;-ms-flex-pack:justify;justify-content:space-between;background:#fff;}.css-1801c4e .sideBarUL li a{color:hsla(0,0%,100%,.8);}.css-1801c4e .sideBarUL .item > a:hover{background-color:hsla(0,0%,100%,.06);color:#fff !important;}@media only screen and (max-width:767px){.css-1801c4e{display:block;}}</style><div class="css-1801c4e e1hlpvzu0"><style data-emotion-css="45umoh">.css-45umoh{width:298px;background-color:#001933;}</style><div class="hiddenMobile css-45umoh e1hlpvzu3"><style data-emotion-css="1sd11cc">.css-1sd11cc{width:100%;height:100vh;overflow:auto;position:fixed;padding-left:0px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;padding-right:0;}@media only screen and (max-width:1023px){.css-1sd11cc{width:100%;height:100vh;}}@media (min-width:767px) and (max-width:1023px){.css-1sd11cc{padding-left:0;}}@media only screen and (max-width:767px){.css-1sd11cc{padding-left:0px;height:auto;}}</style><aside class="css-1sd11cc e1sbq3r11"><ul class="sideBarUL"><li class="hideFrontLine firstLevel item "><ul><li class=" item "><a href="/public-wiki/google-cloud-platform">Google Cloud Platform<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/computer-technology">Computer Technology<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/lean-process-management">Lean Process Management<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/class-notes">Class Notes<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li><li class=" item "><a href="/public-wiki/personal">About Me<button aria-label="collapse" class="collapser"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path d="M7.33 24l-2.83-2.829 9.339-9.175-9.339-9.167 2.83-2.829 12.17 11.996z"></path></svg></button></a></li></ul></li></ul></aside></div><style data-emotion-css="ib50f7">.css-ib50f7{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-flex:1;-webkit-flex-grow:1;-ms-flex-positive:1;flex-grow:1;margin:0px 88px;padding-top:3rem;background:#fff;overflow-x:hidden;}.css-ib50f7 table tr{background:#fff;}@media only screen and (max-width:1023px){.css-ib50f7{padding-left:0;margin:0 10px;padding-top:3rem;}}</style><main class="css-ib50f7 e1hlpvzu1"><style data-emotion-css="14zj307">@media only screen and (max-width:50rem){.css-14zj307{width:100%;position:relative;}}</style><div class="css-14zj307 e1hlpvzu2"><div class="titleWrapper"><style data-emotion-css="10edk9t">.css-10edk9t{font-size:32px;line-height:1.5;font-weight:500;border-left:2px solid #639;padding:0 16px;-webkit-flex:1;-ms-flex:1;flex:1;margin-top:0;padding-top:0;color:#000;}</style><h1 class="css-10edk9t e1m7sxnn0">PubSub Streaming to BigQuery</h1><style data-emotion-css="qu2iew">.css-qu2iew{padding:1rem 1.5rem;text-align:right;}.css-qu2iew a{font-size:14px;font-weight:500;line-height:1em;-webkit-text-decoration:none;text-decoration:none;color:#555;border:1px solid rgb(211,220,228);cursor:pointer;border-radius:3px;-webkit-transition:all 0.2s ease-out 0s;transition:all 0.2s ease-out 0s;-webkit-text-decoration:none;text-decoration:none;color:rgb(36,42,49);background-color:rgb(255,255,255);box-shadow:rgba(116,129,141,0.1) 0px 1px 1px 0px;height:30px;padding:5px 16px;}.css-qu2iew a:hover{background-color:rgb(245,247,249);}</style><div class="mobileView css-qu2iew e1m7sxnn1"><a href="https://github.com/bodhi-root/public-wiki/tree/master/content/google-cloud-platform/pubsub-streaming-to-bigquery.md" class="gitBtn"><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAyMi4xLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjxzdmcgdmVyc2lvbj0iMS4yIiBiYXNlUHJvZmlsZT0idGlueSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiDQoJIHg9IjBweCIgeT0iMHB4IiB2aWV3Qm94PSIwIDAgMjM1MCAyMzE0LjgiIHhtbDpzcGFjZT0icHJlc2VydmUiPg0KPHBhdGggZD0iTTExNzUsMEM1MjUuOCwwLDAsNTI1LjgsMCwxMTc1YzAsNTUyLjIsMzc4LjksMTAxMC41LDg5MC4xLDExMzkuN2MtNS45LTE0LjctOC44LTM1LjMtOC44LTU1Ljh2LTE5OS44SDczNC40DQoJYy03OS4zLDAtMTUyLjgtMzUuMi0xODUuMS05OS45Yy0zOC4yLTcwLjUtNDQuMS0xNzkuMi0xNDEtMjQ2LjhjLTI5LjQtMjMuNS01LjktNDcsMjYuNC00NC4xYzYxLjcsMTcuNiwxMTEuNiw1OC44LDE1OC42LDEyMC40DQoJYzQ3LDYxLjcsNjcuNiw3Ni40LDE1NS43LDc2LjRjNDEuMSwwLDEwNS43LTIuOSwxNjQuNS0xMS44YzMyLjMtODIuMyw4OC4xLTE1NS43LDE1NS43LTE5MC45Yy0zOTMuNi00Ny01ODEuNi0yNDAuOS01ODEuNi01MDUuMw0KCWMwLTExNC42LDQ5LjktMjIzLjMsMTMyLjItMzE3LjNjLTI2LjQtOTEuMS02MS43LTI3OS4xLDExLjgtMzUyLjVjMTc2LjMsMCwyODIsMTE0LjYsMzA4LjQsMTQzLjljODguMS0yOS40LDE4NS4xLTQ3LDI4NC45LTQ3DQoJYzEwMi44LDAsMTk2LjgsMTcuNiwyODQuOSw0N2MyNi40LTI5LjQsMTMyLjItMTQzLjksMzA4LjQtMTQzLjljNzAuNSw3MC41LDM4LjIsMjYxLjQsOC44LDM1Mi41YzgyLjMsOTEuMSwxMjkuMywyMDIuNywxMjkuMywzMTcuMw0KCWMwLDI2NC40LTE4NS4xLDQ1OC4zLTU3NS43LDQ5OS40YzEwOC43LDU1LjgsMTg1LjEsMjE0LjQsMTg1LjEsMzMxLjlWMjI1NmMwLDguOC0yLjksMTcuNi0yLjksMjYuNA0KCUMyMDIxLDIxMjMuOCwyMzUwLDE2ODkuMSwyMzUwLDExNzVDMjM1MCw1MjUuOCwxODI0LjIsMCwxMTc1LDBMMTE3NSwweiIvPg0KPC9zdmc+DQo=" alt="Github logo"/> Edit on GitHub</a></div></div><style data-emotion-css="1qwvub3">.css-1qwvub3{max-width:750px;color:#3B454E;}.css-1qwvub3 ul,.css-1qwvub3 ol{-webkit-padding-start:40px;-moz-padding-start:40px;-o-padding-start:40px;margin:24px 0px;padding:0px 0px 0px 2em;}.css-1qwvub3 ul li,.css-1qwvub3 ol li{font-size:16px;line-height:1.8;font-weight:400;}.css-1qwvub3 a{-webkit-transition:color 0.15s;transition:color 0.15s;color:#1000EE;}.css-1qwvub3 code{border:1px solid #ede7f3;border-radius:4px;padding:2px 6px;font-size:0.9375em;background:'#fff';}.css-1qwvub3 .gatsby-resp-image-wrapper{margin-left:0px !important;}@media (max-width:767px){.css-1qwvub3{padding:0 15px;}}</style><div class="css-1qwvub3 e1m7sxnn2"><p class="paragraph">One design pattern we are trying to build is an event stream published to PubSub that is then streamed into BigQuery.  Several methods exist for reading from PubSub and writing to BigQuery:</p><table><thead><tr><th>Method</th><th>Description</th><th>Pros</th><th>Cons</th></tr></thead><tbody><tr><td>Cloud Functions</td><td>A NodeJS function that would be invoked each time a new message arrives in the PubSub topic. This would insert a row into BigQuery. (Recommended by our Google rep. <a href="https://github.com/kevensen/professional-services/tree/simple-pipeline/examples/simple-pipeline/cloud_function" target="_blank" rel="noopener noreferrer">Link to code</a>)</td><td>Relatively simple.</td><td>Bruce pointed out that this is a table load operation and would limit us to 10,000 inserts per table/day.</td></tr><tr><td>Dataflow</td><td>Streaming Dataflow pipeline (written in Java) (Recommended by the book &quot;Data Science on the Google Cloud Platform&quot;.)</td><td></td><td></td></tr><tr><td>GKE</td><td>Docker pod deployed through Kubernetes to read from PubSub and write to BigQuery. Program can be simple Python.</td><td></td><td></td></tr><tr><td>(Recommended by the Google tutorial at: <a href="https://github.com/GoogleCloudPlatform/kubernetes-bigquery-python/tree/master/pubsub" target="_blank" rel="noopener noreferrer">Link to code</a>)</td><td>Kubernetes would let us scale the streaming code to as many nodes as needed. Also manages deployment and can auto-restart nodes as needed.</td><td>Kubernetes is kind of a pain.</td><td></td></tr><tr><td>GCE</td><td>Deploy a program on Compute Engine that reads from PubSub and writes to BigQuery. Program can be simple Python.	Simple.</td><td>Harder to monitor/support than Kubernetes.</td><td></td></tr></tbody></table><h2 class="heading2" id="googletutorialusinggke">Google Tutorial using GKE</h2><p class="paragraph">Google has a tutorial for accomplishing this using GKE:</p><ul><li><a href="https://github.com/GoogleCloudPlatform/kubernetes-bigquery-python/tree/master/pubsub" target="_blank" rel="noopener noreferrer">https://github.com/GoogleCloudPlatform/kubernetes-bigquery-python/tree/master/pubsub</a></li></ul><p class="paragraph">While most of the steps in this tutorial were relatively straight-forward, I did run into problems when I tried to modify the code to listen for new keywords.  First, I had never compiled docker images before.  This quick start guide was very helpful in walking me through the process of building the image and pushing it to Google&#x27;s container repository.  The commands to do this were:</p><style data-emotion-css="gll2b6">.css-gll2b6{padding:16px;background:#000;}</style><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">docker build </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">t pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token property-access">docker</span><span class="token plain"> tag pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">v1</span></div><div class="token-line"><span class="token plain">docker push gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">v1</span></div></pre></pre></pre><p class="paragraph">When I deployed this to Kubernetes I ran into a problem with the pods crashing though.  I learned how to view a pods logs with:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">kubectl logs bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">controller</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">8679747</span><span class="token plain">dfc</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">dgpjk</span></div></pre></pre></pre><p class="paragraph">and then saw this error:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token function maybe-class-name" style="color:rgb(220, 220, 170)">Traceback</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">most recent call last</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">File</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pubsub-to-bigquery.py&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> line </span><span class="token number" style="color:rgb(181, 206, 168)">25</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> utils</span></div><div class="token-line"><span class="token plain">  </span><span class="token maybe-class-name">File</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;/utils.py&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> line </span><span class="token number" style="color:rgb(181, 206, 168)">27</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">module</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> oauth2client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">client</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token maybe-class-name">GoogleCredentials</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token known-class-name class-name" style="color:rgb(78, 201, 176)">ImportError</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">No</span><span class="token plain"> module named oauth2client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">client</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">For some reason the Dockerfile was not including this necessary dependency.  I found some help online and modified the Dockerfile to include a line to install and upgrade oauth2client.  My Dockerfile then looked like this:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token maybe-class-name">Dockerfile</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">FROM</span><span class="token plain"> python</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade pip</span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> pip install tweepy</span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade oauth2client</span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">api</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">python</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">client</span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> pip install python</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">dateutil</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> controller</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">ADD</span><span class="token plain"> utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">utils</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">CMD</span><span class="token plain"> python controller</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">Re-building the image, pushing to GCR, and re-deploying to Kubernetes was not fixing the problem though.  I kept getting the same error message each time.  Finally, I realized I had to upgrade the image tag to &quot;v2&quot;.  Then I had to modify my Kubernetes deployment descriptors to point to this, and then everything worked.</p><p class="paragraph">WARNING: It seems that Kubernetes is using some kind of image cache that wasn&#x27;t recognizing changes when I kept the same version tag. I could see in GCR that I had pushed a new image with the old tag. I could even see the old image, and I deleted it so that it wouldn&#x27;t be pulling it by mistake. But it was somehow still deploying the old image. Not until I changed the tag to &quot;v2&quot; did everything work out.</p><h3 class="heading3" id="finalcodefiles">Final Code Files</h3><p class="paragraph">For reference, here are the files I finally got working.  The twitter-to-pubsub.py script was modified to change the filter:</p><p class="paragraph"><strong><em>FILE: twitter-to-pubsub.py (snippet)</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">environ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;TWSTREAMMODE&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;sample&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    stream</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">sample</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    stream</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">filter</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       track</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;kroger&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;publix&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;costco&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;heb&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;walmart&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;meijer&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;aldi&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;lidl&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;whole foods&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;hyvee&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;wegmans&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;grocery&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;groceries&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">Note that if the environmental variable &quot;TWSTREAMMODE&quot; is &quot;sample&quot; that this code will never be invoked.  That was something else I missed the first time.</p><p class="paragraph"><strong><em>FILE: bigquery-controller.yaml</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">controller</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">yaml</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">v1beta1</span></div><div class="token-line"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Deployment</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">controller</span></div><div class="token-line"><span class="token plain">  labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">controller</span></div><div class="token-line"><span class="token plain">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">controller</span></div><div class="token-line"><span class="token plain">    spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> bigquery</span></div><div class="token-line"><span class="token plain">        image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">v2</span></div><div class="token-line"><span class="token plain">        env</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PROCESSINGSCRIPT</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUBSUB_TOPIC</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> projects</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">topics</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">twitter_stream</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_DATASET</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter_stream</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_TABLE</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> tweets</span></div></pre></pre></pre><p class="paragraph"><strong><em>FILE: twitter-stream.yaml</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">v1beta1</span></div><div class="token-line"><span class="token plain">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Deployment</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">stream</span></div><div class="token-line"><span class="token plain">  labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">stream</span></div><div class="token-line"><span class="token plain">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">stream</span></div><div class="token-line"><span class="token plain">    spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span></div><div class="token-line"><span class="token plain">        image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bq</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pipe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">v2</span></div><div class="token-line"><span class="token plain">        env</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PROCESSINGSCRIPT</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> twitter</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">PUBSUB_TOPIC</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> projects</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">futurestats</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">grocery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">topics</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">twitter_stream</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CONSUMERKEY</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your_info_here</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">CONSUMERSECRET</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your_info_here</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ACCESSTOKEN</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your_info_here</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">ACCESSTOKENSEC</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> your_info_here</span></div><div class="token-line"><span class="token plain">        </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">TWSTREAMMODE</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> prod</span></div></pre></pre></pre><p class="paragraph">Note that the last variable, &quot;TWSTREAMMODE&quot; was set to &quot;prod&quot;.  Really, anything other than &quot;sample&quot; with work here.  You will also need to insert your own Twitter app credentials, of course.</p><p class="paragraph">Unfortunately, I wasn&#x27;t able to put this code into source control.  I don&#x27;t want my Twitter credentials to be stored there.  <a href="https://kubernetes.io/docs/tasks/inject-data-application/distribute-credentials-secure/" target="_blank" rel="noopener noreferrer">This page</a> has a good example of how to secretly and securely set environment variables, but that will have to be an exercise for another day.</p><h3 class="heading3" id="gcpcosts">GCP Costs</h3><p class="paragraph">I left this running until 2/21 (7 days) and ran up a bill of $26.05.  It looked like it was charging about $4 per day.  The primary costs were for compute.  Details below:</p><p class="paragraph"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:1035px">
      <a href="/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/c5650/gcp-costs-pubsub-to-bigquery.png" target="_blank" rel="noopener noreferrer">
    <span class="gatsby-resp-image-background-image" style="padding-bottom:37.45885450954575%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABAklEQVQoz2VRi27EIAzj/7+xN+n20KRtt/IutIAvDutN2pAs4zRxSGrGGAAGTv4Lhm0a+LQ73r8y3j4ibjbCewfnvLAXdogxqodpvaO1jt6H8kR78PfN4ro84XlZBBe5X/ByfYW1To0Iay1CCNPwkMKUiwS9ct0PlPqLnDJq8oo9B0WOwvv+DzymVoqqgeM4FKUU1cqiq9ybTLCVirxt8k0aZWlUKzbRzKMmjF0D1nXVHRApJdVM5ChM5ljaSGJOYjTi7phz1mWpY8yUaOFl/u2nI19GUxokGXfy1DzcK3fVe3+AMR7mmPOp5w6YQANqdiaH4NWEoGYOi+fPa3rnNz7oDlNHISCVmyM/AAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image" alt="Cost Screenshot" title="Cost Screenshot" src="/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/bcbcb/gcp-costs-pubsub-to-bigquery.png" srcSet="/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/8472d/gcp-costs-pubsub-to-bigquery.png 259w,/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/9eb08/gcp-costs-pubsub-to-bigquery.png 518w,/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/bcbcb/gcp-costs-pubsub-to-bigquery.png 1035w,/public-wiki/static/44392ec3ab8a1d1d0d18ef07662cffe2/c5650/gcp-costs-pubsub-to-bigquery.png 1519w" sizes="(max-width: 1035px) 100vw, 1035px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
  </a>
    </span></p><p class="paragraph">In total this collected 892,298 tweets.</p><h2 class="heading2" id="pythoncodeondocker">Python Code on Docker</h2><p class="paragraph">In trying to replicate the Google tutorial for my own project, I ran into several problems.  First, the Python API client for Google cloud is not installed on VMs by default.  I couldn&#x27;t figure out how to install it either since pip is missing, my VMs seem to be fire-walled off from the internet, and they seem to be firewall-ed off from my company&#x27;s artifactory (which is needing to install Linux modules and Python modules the correct way).  I thought about building docker images on my desktop, uploading them to the cloud, and then running them there, but that&#x27;s a pretty complicated code/test cycle.  Instead, I just created a sandbox project, logged directly into the VM, and was able to use the full power of the cloud and the internet directly.  Here are my notes.</p><h3 class="heading3" id="installpythonlibraries">Install Python Libraries</h3><p class="paragraph">This can be done with:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">sudo apt update</span></div><div class="token-line"><span class="token plain">sudo apt install python3</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pip</span></div><div class="token-line"><span class="token plain">sudo python3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">m pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span></div><div class="token-line"><span class="token plain">sudo python3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">m pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span></div><div class="token-line"><span class="token plain">sudo python3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">m pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade oauth2client</span></div></pre></pre></pre><p class="paragraph">This allows us to perform the following imports:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> pubsub_v1</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> bigquery</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> oauth2client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">client</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token maybe-class-name">GoogleCredentials</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">In order to see what specific versions of these modules installed, I used:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">sudo python3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">m pip freeze</span></div></pre></pre></pre><p class="paragraph">This provided the following key information:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">0.39</span><span class="token number" style="color:rgb(181, 206, 168)">.1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">1.10</span><span class="token number" style="color:rgb(181, 206, 168)">.0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">oauth2client</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">4.1</span><span class="token number" style="color:rgb(181, 206, 168)">.3</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">About 20 other dependencies were also shown, but I&#x27;m assuming if we put these key dependencies into a &quot;requirements.txt&quot; file, they will automatically pull in all the rest.</p><h3 class="heading3" id="bigquerysetup">BigQuery Setup</h3><p class="paragraph">BigQuery can be setup if we have a JSON file that describes the desired schema.  In this case I created &quot;my-schema.json&quot; and then used the following to create a dataset named &quot;dataset&quot; and a table named &quot;table&quot;:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">bq mk dataset</span></div><div class="token-line"><span class="token plain">bq mk </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">t dataset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">table</span><span class="token plain"> my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">schema</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">json</span><span class="token plain"></span></div></pre></pre></pre><h3 class="heading3" id="pythonscripts">Python Scripts</h3><p class="paragraph">The Python scripts weren&#x27;t too hard to write once the environment was setup.  To make things easy, I wrote them on my desktop and then uploaded them to the VM.  I ended up with the following files:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">test</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain">         # simple listener that listens to </span><span class="token maybe-class-name">PubSub</span><span class="token plain"> and prints message </span><span class="token keyword module" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> they arrive</span></div><div class="token-line"><span class="token plain">file</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain">      # generate sample data and push to </span><span class="token maybe-class-name">PubSub</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain">  # program that listens to </span><span class="token maybe-class-name">PubSub</span><span class="token plain"> and pushes messages to </span><span class="token maybe-class-name">BigQuery</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">These scripts still need some work to be production-ready, but in order to keep from having to read through all the crazy GCP documentation again, here they are:</p><p class="paragraph"><strong><em>File: pubsub-test.py</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> time</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> pubsub_v1</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gcp_project_id&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">SUBSCRIPTION_NAME</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pubsub_subscription_name&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscriber </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pubsub_v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(220, 220, 170)">SubscriberClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscription_path </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SUBSCRIPTION_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Received message: {}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">ack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscriber</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">subscribe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> callback</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Listening for messages on {}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token maybe-class-name">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph"><strong><em>File: file-to-pubsub.py</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> random</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> datetime</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> time</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> pubsub_v1</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gcp_project_id&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">TOPIC_NAME</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;topic_name&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">### </span><span class="token maybe-class-name">Load</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">XML</span><span class="token plain"> messages into memory</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">sample_file </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;data/sample/sensor-xml.log&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Reading file: {}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sample_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">xml_lines </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">with</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">open</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">sample_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;r&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">as</span><span class="token plain"> file_in</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> line </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> file_in</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        xml_lines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">append</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Loaded {} sample messages into memory&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token function" style="color:rgb(220, 220, 170)">len</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">xml_lines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">### </span><span class="token maybe-class-name">Randomly</span><span class="token plain"> send message to </span><span class="token maybe-class-name">PubSub</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">publisher </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pubsub_v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(220, 220, 170)">PublisherClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">FULL_TOPIC_NAME</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;projects/{project_id}/topics/{topic}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    project_id</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    topic</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token constant" style="color:rgb(100, 102, 149)">TOPIC_NAME</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token maybe-class-name">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    xml_line </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> random</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">choice</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">xml_lines</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    message_bytes </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> xml_line</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">encode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> # </span><span class="token keyword module" style="color:rgb(86, 156, 214)">default</span><span class="token plain"> to utf</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token number" style="color:rgb(181, 206, 168)">8</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Writing message at {}&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">datetime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">datetime</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">now</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    publisher</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">publish</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">FULL_TOPIC_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> message_bytes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain">  </span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> # sleep </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain"> seconds</span></div></pre></pre></pre><p class="paragraph"><strong><em>File: pubsub-to-bigquery.py</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> time</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> pubsub_v1</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">cloud</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> bigquery</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword module" style="color:rgb(86, 156, 214)">from</span><span class="token plain"> seventyfive</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access maybe-class-name">SensorEvent</span><span class="token plain"> </span><span class="token keyword module" style="color:rgb(86, 156, 214)">import</span><span class="token plain"> </span><span class="token maybe-class-name">SensorEvent</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;gcp_project_id&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">SUBSCRIPTION_NAME</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;pubsub_subscription_name&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_DATASET_ID</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;dataset&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_TABLE_NAME</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;table&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscriber </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pubsub_v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(220, 220, 170)">SubscriberClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">bq_client </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(220, 220, 170)">Client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">bq_table </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> bq_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">get_table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">bq_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">dataset</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_DATASET_ID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">BQ_TABLE_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscription_path </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> subscriber</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token constant" style="color:rgb(100, 102, 149)">PROJECT_ID</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">SUBSCRIPTION_NAME</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">def </span><span class="token function" style="color:rgb(220, 220, 170)">callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Received message: {}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">    xml </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">decode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    sensor_event </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token maybe-class-name">SensorEvent</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">parse_xml</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">xml</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">    bq_rows </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> sensor_event</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">to_bq_rows</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    errors </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> bq_client</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">insert_rows</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">bq_table</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> bq_rows</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;Errors: &quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">errors</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">    message</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">ack</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain">subscriber</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">subscribe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> callback</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">callback</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">print</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&#x27;Listening for messages on {}&#x27;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">format</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token plain">subscription_path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token maybe-class-name">True</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    time</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">sleep</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">Nothing too tricky here.  The work to parse the SensorEvent XML file is encapsulated in the SensorEvent object.  The code that generates rows to insert into BigQuery is also in that object.  These rows are simply dictionaries of key/value pairs for the column names and values we are inserting.  These scripts need some more error handling and then I&#x27;ll put them in git.  We also need to bundle them up and build them into a docker image, but that will be work for another day.</p><h3 class="heading3" id="writingtopubsubfromon-prem">Writing to PubSub from On-Prem</h3><p class="paragraph">The code above writes to PubSub from a GCE instance.  If we want to test writing messages from on-prem (which is what the ESB team will have to do in order to publish to our GCP PubSub topic), we need to make a few small changes.  First, we generate a service account and save it&#x27;s token to a JSON file.  This service account should have permission to publish to PubSub.  Then we modify our Python code that instantiates the client to use this service account file:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">publisher </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> pubsub_v1</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access maybe-class-name">PublisherClient</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token method function property-access" style="color:rgb(220, 220, 170)">from_service_account_file</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;service-account-file.json&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">You will also need to use the Proxy to connect to GCP.  This can be set through an environmental variable.  If you do it in Python (which is not recommended) it looks like this:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">os</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">environ</span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">&quot;https_proxy&quot;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">&quot;http://user:pass@proxy.domain.com:8888/&quot;</span><span class="token plain"></span></div></pre></pre></pre><h3 class="heading3" id="deployingasadockercontainer">Deploying as a Docker Container</h3><p class="paragraph">WARNING: I can get this to work in the sandbox but not in our corporate project. For some reason, the default application credentials in the corporate project do not appear to have access to the BigQuery APIs.</p><p class="paragraph">I tried deploying this app as a docker container using the following Dockerfile:</p><p class="paragraph"><strong><em>File: Dockerfile</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token constant" style="color:rgb(100, 102, 149)">FROM</span><span class="token plain"> python</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">3.7</span><span class="token number" style="color:rgb(181, 206, 168)">.2</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">slim</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">stretch</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">WORKDIR</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">src</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">app</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"># </span><span class="token maybe-class-name">Add</span><span class="token plain"> files to the image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> placing them </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">WORKDIR</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">COPY</span><span class="token plain"> requirements</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">txt</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"># </span><span class="token maybe-class-name">Install</span><span class="token plain"> python packages</span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">RUN</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">set</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">x \</span></div><div class="token-line"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">upgrade pip \</span></div><div class="token-line"><span class="token plain">    </span><span class="token operator" style="color:rgb(212, 212, 212)">&amp;&amp;</span><span class="token plain"> pip install </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">no</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cache </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">r requirements</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">txt</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">COPY</span><span class="token plain"> pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">COPY</span><span class="token plain"> seventyfive </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">seventyfive</span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token constant" style="color:rgb(100, 102, 149)">CMD</span><span class="token plain"> python3 </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">to</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">py</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">This uses the slim version of the python 3.7.2 image (as Marcus had recommended).  Python dependencies are then loaded from the requirements.txt file which uses the version info of the dependencies we manually installed earlier:</p><p class="paragraph"><strong><em>File: requirements.txt</em></strong></p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">0.39</span><span class="token number" style="color:rgb(181, 206, 168)">.1</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">google</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">cloud</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">1.10</span><span class="token number" style="color:rgb(181, 206, 168)">.0</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">oauth2client</span><span class="token operator" style="color:rgb(212, 212, 212)">==</span><span class="token number" style="color:rgb(181, 206, 168)">4.1</span><span class="token number" style="color:rgb(181, 206, 168)">.3</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">It then runs the &quot;pubsub-to-bigquery.py&quot; program.</p><p class="paragraph">I am able to build the image locally using:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">docker build </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">t baler</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">sensor</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pubsub</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div><div class="token-line"><span class="token plain" style="display:inline-block"></span></div><div class="token-line"><span class="token plain"></span><span class="token property-access">gcloud</span><span class="token plain"> auth configure</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">docker</span></div><div class="token-line"><span class="token plain">docker tag my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"> gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker push gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">I can then login to the GCE instance (which is using the container-optimized OS), download, and run this image with:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">docker</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">credential</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">gcr configure</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">docker</span></div><div class="token-line"><span class="token plain">docker pull gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">--</span><span class="token plain">rm gcr</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">io</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">my</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">1.0</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token constant" style="color:rgb(100, 102, 149)">SNAPSHOT</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">However, I&#x27;m running into the following errors:</p><pre class="css-gll2b6 ev1gfv90"><pre><pre class="prism-code language-javascript pre" style="color:#9CDCFE;background-color:#1E1E1E" p="3"><div class="token-line"><span class="token plain">google</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">api_core</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">exceptions</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access maybe-class-name">Forbidden</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">403</span><span class="token plain"> </span><span class="token constant" style="color:rgb(100, 102, 149)">GET</span><span class="token plain"> https</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">www</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">googleapis</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token property-access">com</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">bigquery</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">v2</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">projects</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">project</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">datasets</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">dataset</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">tables</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token operator" style="color:rgb(212, 212, 212)">&lt;</span><span class="token plain">table</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Request</span><span class="token plain"> had insufficient authentication scopes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain"></span></div></pre></pre></pre><p class="paragraph">I was able to run this successfully in my sandbox project.  It&#x27;s the exact same docker image, but it fails in our corporate dev project.  It looks like our GCE instance does not have the required access to the BigQuery APIs.</p></div><div class="addPaddTopBottom"><style data-emotion-css="11g79x">.css-11g79x{margin:0px;padding:0px;width:auto;display:grid;grid-template-rows:auto;-webkit-column-gap:24px;column-gap:24px;grid-template-columns:calc(50% - 8px) calc(50% - 8px);}.css-11g79x .previousBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#001933;color:#fff;}.css-11g79x .nextBtn{cursor:pointer;-moz-box-align:center;-moz-box-direction:normal;-moz-box-orient:horizontal;margin:0px;padding:0px;position:relative;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex-direction:row;-ms-flex-direction:row;flex-direction:row;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;place-self:stretch;border-radius:3px;border:1px solid rgb(230,236,241);-webkit-transition:border 200ms ease 0s;transition:border 200ms ease 0s;box-shadow:rgba(116,129,141,0.1) 0px 3px 8px 0px;-webkit-text-decoration:none;text-decoration:none;background-color:#001933;color:#fff;}.css-11g79x .nextBtn:hover,.css-11g79x .previousBtn:hover{-webkit-text-decoration:none;text-decoration:none;border:1px solid #1ed3c6;}.css-11g79x .nextBtn:hover .rightArrow,.css-11g79x .previousBtn:hover .leftArrow{color:#1ed3c6;}.css-11g79x .leftArrow{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin:0px;color:rgb(157,170,182);-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-right:16px;}.css-11g79x .rightArrow{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-flex:0 0 auto;-ms-flex:0 0 auto;flex:0 0 auto;font-size:24px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;padding:16px;padding-left:16px;margin:0px;color:rgb(157,170,182);}.css-11g79x .nextPreviousTitle{display:block;margin:0px;padding:0px;-webkit-transition:color 200ms ease 0s;transition:color 200ms ease 0s;}.css-11g79x .nextPreviousTitle span{font-size:16px;line-height:1.5;font-weight:500;}@media (max-width:767px){.css-11g79x{display:block;padding:0 15px;}.css-11g79x .previousBtn{margin-bottom:20px;}}</style><div class="css-11g79x ex6i9xe0"><a class="previousBtn" href="/public-wiki/google-cloud-platform/google-container-registry"><div class="leftArrow"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" class="_13gjrqj"><g><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></g></svg></div><div class="preRightWrapper"><div class="smallContent"><span>Previous</span></div><div class="nextPreviousTitle"><span>GCR (Google Container Registry)</span></div></div></a><a class="nextBtn" href="/public-wiki/google-cloud-platform/virtual-private-cloud"><div class="nextRightWrapper"><div class="smallContent"><span>Next</span></div><div class="nextPreviousTitle"><span>Virtual Private Cloud (VPC)</span></div></div><div class="rightArrow"><svg preserveAspectRatio="xMidYMid meet" height="1em" width="1em" fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" class="_13gjrqj"><g><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></g></svg></div></a></div></div></div></main><style data-emotion-css="gqp3x7">.css-gqp3x7{width:224px;}</style><div class="hiddenMobile css-gqp3x7 e1hlpvzu4"><style data-emotion-css="1dq6tsi">.css-1dq6tsi{width:100%;border-right:1px solid #ede7f3;height:100vh;overflow:auto;position:fixed;padding-left:24px;position:-webkit-sticky;position:-moz-sticky;position:-webkit-sticky;position:sticky;top:0;background:#fff;}.css-1dq6tsi .rightSideTitle{font-size:10px;line-height:1;font-weight:700;text-transform:uppercase;-webkit-letter-spacing:1.2px;-moz-letter-spacing:1.2px;-ms-letter-spacing:1.2px;letter-spacing:1.2px;padding:7px 24px 7px 16px;border-left:1px solid #e6ecf1;border-left-color:rgb(230,236,241);color:#3B454E;}.css-1dq6tsi .rightSideBarUL{margin-top:32px;}.css-1dq6tsi .rightSideBarUL li{list-style-type:none;border-left:1px solid #e6ecf1;border-left-color:rgb(230,236,241);}.css-1dq6tsi .rightSideBarUL li a{font-size:12px;font-weight:500;line-height:1.5;padding:7px 24px 7px 16px;color:#3B454E;}@media only screen and (max-width:50rem){.css-1dq6tsi{width:100%;position:relative;}}</style><aside class="css-1dq6tsi e1y52jk20"><ul></ul></aside></div></div></div></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/google-cloud-platform/pubsub-streaming-to-bigquery";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-a84f0d851128ba8e273f.js"],"component---src-templates-docs-js":[]};/*]]>*/</script><script src="/public-wiki/app-a84f0d851128ba8e273f.js" async=""></script><script src="/public-wiki/commons-926e13980b7ff3c9526c.js" async=""></script><script src="/public-wiki/webpack-runtime-f2d0ecacffeda2b3fda9.js" async=""></script><script defer="">
            function navBarClose() {
              document.getElementById("navbar").classList.toggle("responsive");
            }
            document.addEventListener('click',function(e){
              if(e.target && e.target.tagName.toLowerCase() === 'a'){
                navBarClose();
              }
           });
            </script></body></html>